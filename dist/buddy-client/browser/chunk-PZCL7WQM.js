import{b as ee,f as te,g as ie,i as oe,m as ne}from"./chunk-72IVDTWN.js";import{b as V,e as U,f as j,g as Q,h as W,i as q,l as $,m as G,n as K,o as Y,q as Z}from"./chunk-7GLGJSVC.js";import{b as S,c as z}from"./chunk-XVS3UUSK.js";import{A as O,E as X,G as J}from"./chunk-MOGANAOV.js";import{$a as T,Aa as c,Fa as i,Ga as n,Ha as M,I as y,Ia as v,Ib as H,Ja as b,Kb as B,L as u,La as R,Na as p,Oa as _,P as f,Q as h,Xa as N,Ya as r,aa as w,ab as E,bb as F,eb as I,ja as a,ob as P,ra as m,sa as C,ub as L,wa as D,zb as k}from"./chunk-V4W4SR2I.js";var re=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275mod=C({type:s});static \u0275inj=y({imports:[ee]})}return s})();var se=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275mod=C({type:s});static \u0275inj=y({imports:[O,re,O]})}return s})();var x=class s{api=u(S);dialogRef=u(ie);targetUser="";type="MEMBER";submit(){this.api.createApplication({targetUser:this.targetUser,type:this.type}).subscribe({next:()=>this.dialogRef.close("success"),error:()=>alert("Failed to create application")})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=m({type:s,selectors:[["app-new-admin-app-dialog"]],decls:20,vars:5,consts:[["form","ngForm"],[3,"ngSubmit"],["name","targetUser","required","",3,"ngModelChange","ngModel"],["name","type","required","",3,"ngModelChange","ngModel"],[3,"ngValue"],["type","submit",3,"disabled"],["type","button",3,"click"]],template:function(t,o){if(t&1){let l=R();i(0,"h2"),r(1,"New Admin Application"),n(),i(2,"form",1,0),p("ngSubmit",function(){return f(l),h(o.submit())}),i(4,"label"),r(5," Target User: "),i(6,"input",2),F("ngModelChange",function(d){return f(l),E(o.targetUser,d)||(o.targetUser=d),h(d)}),n()(),M(7,"br"),i(8,"label"),r(9," Type: "),i(10,"select",3),F("ngModelChange",function(d){return f(l),E(o.type,d)||(o.type=d),h(d)}),i(11,"option",4),r(12,"Member"),n(),i(13,"option",4),r(14,"Admin"),n()()(),M(15,"br"),i(16,"button",5),r(17,"Create"),n(),i(18,"button",6),p("click",function(){return f(l),h(o.close())}),r(19,"Cancel"),n()()}if(t&2){let l=N(3);a(6),T("ngModel",o.targetUser),a(4),T("ngModel",o.type),a(),c("ngValue","MEMBER"),a(2),c("ngValue","ADMIN"),a(3),c("disabled",l.invalid)}},dependencies:[k,Z,q,G,K,V,$,U,j,Y,W,Q],styles:["[_nghost-%COMP%]{display:block;padding:24px;background:#1e1e1e;color:#eee;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;border-radius:12px;box-shadow:0 0 15px #64b5f6aa;max-width:400px;margin:0 auto}h2[_ngcontent-%COMP%]{margin-top:0;font-size:1.6rem;font-weight:700;color:#90caf9;text-align:center;margin-bottom:24px}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-weight:600;color:#b3e5fc}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{margin-top:6px;padding:10px 12px;border:none;border-radius:6px;background:#2c2c2c;color:#eee;font-size:1rem}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 6px #64b5f6aa}button[_ngcontent-%COMP%]{padding:10px 16px;border:none;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:background-color .3s ease}button[type=submit][_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;box-shadow:0 4px 12px #64b5f6cc}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#1565c0}button[type=button][_ngcontent-%COMP%]{background-color:#555;color:#eee}button[type=button][_ngcontent-%COMP%]:hover{background-color:#777}"]})};var Ce=()=>["/home"];function De(s,e){if(s&1){let t=R();v(0),i(1,"app-application-card",14),p("refreshed",function(){f(t);let l=_();return h(l.refresh())}),n(),b()}if(s&2){let t=e.$implicit,o=_();a(),c("app",t)("canVote",o.canVote(t))("canUnvote",o.canUnvote(t))}}var ae=class s{api=u(S);dialog=u(oe);auth=u(z);adminsCount=w(0);apps=w([]);selectedStatus=w("");currentUser=this.auth.user();displayedColumns=[{key:"id",label:"ID",sortable:!0},{key:"target",label:"Target",sortable:!0},{key:"type",label:"Type",sortable:!0},{key:"approvers",label:"Approvers"},{key:"actions",label:"Actions"}];columnKeys=this.displayedColumns.map(e=>e.key);filteredApps=P(()=>{let e=this.selectedStatus();return e?this.apps().filter(t=>t.status===e):this.apps()});constructor(){this.loadAdminsCount(),this.load()}loadAdminsCount(){this.api.getAllUsers().subscribe({next:e=>{let t=e.filter(o=>o.role==="ADMIN");this.adminsCount.set(t.length)},error:()=>this.adminsCount.set(0)})}load(){this.api.getAll().subscribe({next:e=>this.apps.set(e),error:e=>console.error("Failed to load applications:",e)})}refresh(){this.load()}onStatusFilterChange(e){let t=e.target;this.selectedStatus.set(t.value)}vote(e){this.api.vote(e.id).subscribe(()=>this.load())}unvote(e){this.api.unvote(e.id).subscribe(()=>this.load())}closeApplication(e){this.api.deleteApplication(e.id).subscribe(()=>this.load())}openNewAdminApp(){this.dialog.open(x,{width:"400px",data:{}}).afterClosed().subscribe(t=>{t==="success"&&this.load()})}requiredVotes(e){return e.type==="ADMIN"?this.adminsCount():2}hasEnoughVotes(e){return e.type==="ADMIN"?(e.votes?.length??0)===this.adminsCount():(e.votes?.length??0)>=2}canVote(e){let t=this.currentUser();return!this.hasEnoughVotes(e)&&!!t&&!e.votes.includes(t.username)}canUnvote(e){let t=this.currentUser();return!!t&&e.votes.includes(t.username)}get allApplications(){return this.filteredApps()}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=m({type:s,selectors:[["app-admin"]],decls:23,vars:4,consts:[[1,"container"],["mat-button","","color","primary",1,"back-button",3,"routerLink"],[1,"title"],[1,"status-filter"],["for","status-filter"],["id","status-filter",3,"change","value"],["value",""],["value","PENDING"],["value","WAITING_VOTES"],["value","WAITING_UNANIMOUS"],["value","APPROVED"],["value","CANCELLED"],[1,"apps-container"],[4,"ngFor","ngForOf"],[3,"refreshed","app","canVote","canUnvote"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"button",1),r(2," \u2190 Back to Home "),n(),i(3,"h1",2),r(4,"Admin Panel"),n(),i(5,"div",3)(6,"label",4),r(7,"Filter by status:"),n(),i(8,"select",5),p("change",function(g){return o.onStatusFilterChange(g)}),i(9,"option",6),r(10,"All"),n(),i(11,"option",7),r(12,"Pending"),n(),i(13,"option",8),r(14,"Waiting for votes"),n(),i(15,"option",9),r(16,"Waiting for unanimous"),n(),i(17,"option",10),r(18,"Approved"),n(),i(19,"option",11),r(20,"Cancelled"),n()()(),i(21,"div",12),D(22,De,2,3,"ng-container",13),n()()),t&2&&(a(),c("routerLink",I(3,Ce)),a(7),c("value",o.selectedStatus()),a(14),c("ngForOf",o.allApplications))},dependencies:[se,J,X,ne,B,H,k,L,te],styles:[".container[_ngcontent-%COMP%]{max-width:900px;margin:40px auto;padding:20px;background:#f9f9f9;border-radius:10px;color:#222;font-family:Arial,sans-serif;box-shadow:0 4px 12px #0000001a}.back-button[_ngcontent-%COMP%]{margin-bottom:20px;font-weight:600;font-size:1rem;text-transform:none;color:#1976d2}.back-button[_ngcontent-%COMP%]:hover{color:#1565c0}.title[_ngcontent-%COMP%]{margin:0 0 20px;font-weight:700;font-size:2rem;color:#0d47a1;text-align:center}.new-admin-btn[_ngcontent-%COMP%]{display:block;margin:0 auto 30px;width:220px;font-weight:600;font-size:1.1rem;color:#fff}.admin-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border-radius:6px;overflow:hidden;box-shadow:0 2px 6px #0000001a}th.mat-header-cell[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;font-weight:700;padding:12px 10px;text-transform:uppercase;border-bottom:2px solid #1565c0}td.mat-cell[_ngcontent-%COMP%]{padding:12px 10px;border-bottom:1px solid #ddd;font-size:1rem;color:#222}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}button.mat-button[_ngcontent-%COMP%]{margin-right:8px;font-weight:600;text-transform:none}button.mat-button[color=primary][_ngcontent-%COMP%]{color:#1976d2}button.mat-button[color=warn][_ngcontent-%COMP%]{color:#d32f2f}button.mat-button[_ngcontent-%COMP%]:last-child{margin-right:0}.status-filter[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;margin-bottom:20px;gap:12px;font-size:1rem;color:#444}.status-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#0d47a1}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:1.5px solid #1976d2;font-size:1rem;font-weight:500;background-color:#fff;color:#222;cursor:pointer;transition:border-color .3s ease}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover, .status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#1565c0;outline:none}"]})};export{ae as AdminComponent};
