import{b as N,f as I,g as P,h as H,i as L}from"./chunk-IIIIKON4.js";import"./chunk-YRVXRTIC.js";import{b as E,c as F}from"./chunk-X4D7FLKK.js";import{C as O,E as A,y as w}from"./chunk-2V3KUT7M.js";import{Ba as _,Bb as M,Ca as g,Db as T,E as d,Ea as R,Ga as y,H as u,Ha as c,L as D,M as v,Ra as s,X as f,_a as b,da as a,ib as k,la as h,ma as m,ob as S,pa as p,ta as l,tb as x,ya as o,za as n}from"./chunk-OK7BFXF3.js";var B=(()=>{class i{static \u0275fac=function(r){return new(r||i)};static \u0275mod=m({type:i});static \u0275inj=d({imports:[N]})}return i})();var j=(()=>{class i{static \u0275fac=function(r){return new(r||i)};static \u0275mod=m({type:i});static \u0275inj=d({imports:[w,B,w]})}return i})();var ee=()=>["/home"];function te(i,e){if(i&1){let t=R();_(0),o(1,"app-application-card",14),y("refreshed",function(){D(t);let C=c();return v(C.refresh())}),n(),g()}if(i&2){let t=e.$implicit,r=c();a(),l("app",t)("canVote",r.canVote(t))("canUnvote",r.canUnvote(t))}}var V=class i{api=u(E);dialog=u(P);auth=u(F);adminsCount=f(0);apps=f([]);selectedStatus=f("");currentUser=this.auth.user();displayedColumns=[{key:"id",label:"ID",sortable:!0},{key:"target",label:"Target",sortable:!0},{key:"type",label:"Type",sortable:!0},{key:"approvers",label:"Approvers"},{key:"actions",label:"Actions"}];columnKeys=this.displayedColumns.map(e=>e.key);filteredApps=k(()=>{let e=this.selectedStatus();return e?this.apps().filter(t=>t.status===e):this.apps()});constructor(){this.loadAdminsCount(),this.load()}loadAdminsCount(){this.api.getAllUsers().subscribe({next:e=>{let t=e.filter(r=>r.role==="ADMIN");this.adminsCount.set(t.length)},error:()=>this.adminsCount.set(0)})}load(){this.api.getAll().subscribe({next:e=>this.apps.set(e),error:e=>console.error("Failed to load applications:",e)})}refresh(){this.load()}onStatusFilterChange(e){let t=e.target;this.selectedStatus.set(t.value)}vote(e){this.api.vote(e.id).subscribe(()=>this.load())}unvote(e){this.api.unvote(e.id).subscribe(()=>this.load())}closeApplication(e){this.api.deleteApplication(e.id).subscribe(()=>this.load())}openNewAdminApp(){this.dialog.open(L,{width:"400px",data:{}}).afterClosed().subscribe(t=>{t==="success"&&this.load()})}requiredVotes(e){return e.type==="ADMIN"?this.adminsCount():2}hasEnoughVotes(e){return e.type==="ADMIN"?(e.votes?.length??0)===this.adminsCount():(e.votes?.length??0)>=2}canVote(e){let t=this.currentUser();return!this.hasEnoughVotes(e)&&!!t&&!e.votes.includes(t.username)}canUnvote(e){let t=this.currentUser();return!!t&&e.votes.includes(t.username)}get allApplications(){return this.filteredApps()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=h({type:i,selectors:[["app-admin"]],decls:23,vars:4,consts:[[1,"container"],["mat-button","","color","primary",1,"back-button",3,"routerLink"],[1,"title"],[1,"status-filter"],["for","status-filter"],["id","status-filter",3,"change","value"],["value",""],["value","PENDING"],["value","WAITING_VOTES"],["value","WAITING_UNANIMOUS"],["value","APPROVED"],["value","DELETED"],[1,"apps-container"],[4,"ngFor","ngForOf"],[3,"refreshed","app","canVote","canUnvote"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"button",1),s(2," \u2190 Back to Home "),n(),o(3,"h1",2),s(4,"Admin Panel"),n(),o(5,"div",3)(6,"label",4),s(7,"Filter by status:"),n(),o(8,"select",5),y("change",function(U){return r.onStatusFilterChange(U)}),o(9,"option",6),s(10,"All"),n(),o(11,"option",7),s(12,"Pending"),n(),o(13,"option",8),s(14,"Waiting for votes"),n(),o(15,"option",9),s(16,"Waiting for unanimous"),n(),o(17,"option",10),s(18,"Approved"),n(),o(19,"option",11),s(20,"Cancelled"),n()()(),o(21,"div",12),p(22,te,2,3,"ng-container",13),n()()),t&2&&(a(),l("routerLink",b(3,ee)),a(7),l("value",r.selectedStatus()),a(14),l("ngForOf",r.allApplications))},dependencies:[j,A,O,H,T,M,x,S,I],styles:[".container[_ngcontent-%COMP%]{max-width:900px;margin:40px auto;padding:20px;background:#f9f9f9;border-radius:10px;color:#222;font-family:Arial,sans-serif;box-shadow:0 4px 12px #0000001a}.back-button[_ngcontent-%COMP%]{margin-bottom:20px;font-weight:600;font-size:1rem;text-transform:none;color:#1976d2}.back-button[_ngcontent-%COMP%]:hover{color:#1565c0}.title[_ngcontent-%COMP%]{margin:0 0 20px;font-weight:700;font-size:2rem;color:#0d47a1;text-align:center}.new-admin-btn[_ngcontent-%COMP%]{display:block;margin:0 auto 30px;width:220px;font-weight:600;font-size:1.1rem;color:#fff}.admin-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border-radius:6px;overflow:hidden;box-shadow:0 2px 6px #0000001a}th.mat-header-cell[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;font-weight:700;padding:12px 10px;text-transform:uppercase;border-bottom:2px solid #1565c0}td.mat-cell[_ngcontent-%COMP%]{padding:12px 10px;border-bottom:1px solid #ddd;font-size:1rem;color:#222}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}button.mat-button[_ngcontent-%COMP%]{margin-right:8px;font-weight:600;text-transform:none}button.mat-button[color=primary][_ngcontent-%COMP%]{color:#1976d2}button.mat-button[color=warn][_ngcontent-%COMP%]{color:#d32f2f}button.mat-button[_ngcontent-%COMP%]:last-child{margin-right:0}.status-filter[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;margin-bottom:20px;gap:12px;font-size:1rem;color:#444}.status-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#0d47a1}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 12px;border-radius:6px;border:1.5px solid #1976d2;font-size:1rem;font-weight:500;background-color:#fff;color:#222;cursor:pointer;transition:border-color .3s ease}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover, .status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#1565c0;outline:none}"]})};export{V as AdminComponent};
